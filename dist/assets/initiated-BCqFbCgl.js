import{r as n,o as w,j as R,w as o,c as A,I as $,Z as O,s as G,u as H,b as a,g as Z,e as L,G as q,H as D,d as J}from"./index-CPZCLJhI.js";import{d as K,e as Q,_ as W,E as X,a as Y,b as ee,c as ae,v as te}from"./el-table-column-Cw6mIs8X.js";import{E as le}from"./el-input-EJwEnXI7.js";import"./el-popper-CBzjx_xb.js";import{E as T}from"./el-button-aGybSvRj.js";import{v as oe}from"./_plugin-vue_export-helper-C52UWfAG.js";import{g as ne,a as se,b as ue}from"./approval-BgBZ2utT.js";import{E as re}from"./el-dialog-DrTM45KF.js";import"./el-overlay-DNljXtA7.js";import{E as ie,a as ce}from"./el-form-item-CvQ51XjY.js";import{d as j}from"./user-IFSiVi_8.js";import{E as F}from"./request-Bo9Nm4OM.js";import{E as de}from"./el-message-box-JObjlNit.js";import"./_initCloneObject-CWwr7yUn.js";const I={__name:"ChannelSelect",props:{modelValue:{type:[Number,String]},width:{type:String}},emits:["update:modelValue"],setup(N,{emit:b}){const _=n([]);(async()=>{const t=await j();_.value=t.data})();const e=b;return(t,s)=>{const i=K,m=Q;return w(),R(m,{modelValue:N.modelValue,"onUpdate:modelValue":s[0]||(s[0]=u=>e("update:modelValue",u)),size:"large",style:G({width:N.width})},{default:o(()=>[(w(!0),A($,null,O(_.value,u=>(w(),R(i,{key:u.id,label:u.username,value:u.username},null,8,["label","value"]))),128))]),_:1},8,["modelValue","style"])}}},pe={class:"dialog-footer"},me={__name:"ChannelEdit",emits:["success"],setup(N,{expose:b,emit:_}){const r=H(),e=n({initiatorId:r.user.id,initiatorName:r.user.username,nodeCounts:1,processName:"",processNodeRequestList:[]}),t=n(""),s=n(""),i=n(""),m=n(!1),u=n(!1),k=()=>{t.value!==""&m.value===!1?(m.value=!0,e.value.nodeCounts=1):s.value!==""&u.value===!1&&(u.value=!0,e.value.nodeCounts=2)},S=n([]);(async()=>{const d=await j();S.value=d.data,console.log("审批人数据",d.data)})();const C={processName:[{required:!0,message:"请输入流程名称",trigger:"blur"}]},v=n(!1);b({open:d=>{g(),v.value=!0}});const z=_,x=n(),h=d=>{const l=S.value.find(f=>f.username===d);return l?l.id:null},E=(d,l,f)=>({nodeSequence:d,receiverId:l,receiverName:f}),U=async()=>{if(await x.value.validate(),console.log("第1审批人",t.value,"第2审批人",s.value,"第3审批人",i.value),t.value===""||e.value.processName==="")return;if(t.value!==""){console.log(1),e.value.nodeCounts=1;const l=h(t.value);if(e.value.processNodeRequestList.push(E(0,l,t.value)),s.value!==""){console.log(2);const f=h(s.value);if(e.value.nodeCounts=2,e.value.processNodeRequestList.push(E(1,f,s.value)),i.value!==""){console.log(3);const y=h(i.value);e.value.nodeCounts=3,e.value.processNodeRequestList.push(E(2,y,i.value))}}}console.log("参数",e.value);const d=e.value.id;await ne(e.value),z("success"),F({type:"success",message:d?"编辑成功":"添加成功"}),v.value=!1},g=()=>{v.value=!1,t.value="",s.value="",i.value="",m.value=!1,u.value=!1,e.value.processNodeList=[],e.value.nodeCounts=1};return(d,l)=>{const f=le,y=ie,M=ce,B=T,P=re;return w(),A("div",null,[a(P,{modelValue:v.value,"onUpdate:modelValue":l[4]||(l[4]=p=>v.value=p),title:e.value.id?"编辑":"添加",width:"50%"},{footer:o(()=>[Z("div",pe,[a(B,{onClick:k},{default:o(()=>[L("添加审批人")]),_:1}),a(B,{onClick:g},{default:o(()=>[L("取消")]),_:1}),a(B,{type:"primary",onClick:U},{default:o(()=>[L("确认")]),_:1})])]),default:o(()=>[a(M,{model:e.value,rules:C,"label-width":"100px",style:{"padding-right":"30px"},ref_key:"formRef",ref:x},{default:o(()=>[a(y,{label:"流程名称",prop:"processName"},{default:o(()=>[a(f,{modelValue:e.value.processName,"onUpdate:modelValue":l[0]||(l[0]=p=>e.value.processName=p),minlength:"1",maxlength:"20"},null,8,["modelValue"])]),_:1}),a(y,{label:"选择审批人1"},{default:o(()=>[a(I,{modelValue:t.value,"onUpdate:modelValue":l[1]||(l[1]=p=>t.value=p),width:"200px"},null,8,["modelValue"])]),_:1}),q(a(y,{label:"选择审批人2"},{default:o(()=>[a(I,{modelValue:s.value,"onUpdate:modelValue":l[2]||(l[2]=p=>s.value=p),width:"200px"},null,8,["modelValue"])]),_:1},512),[[D,m.value]]),q(a(y,{label:"选择审批人3"},{default:o(()=>[a(I,{modelValue:i.value,"onUpdate:modelValue":l[3]||(l[3]=p=>i.value=p),width:"200px"},null,8,["modelValue"])]),_:1},512),[[D,u.value]])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Le={__name:"initiated",setup(N){const b=n([]),_=n(0),r=n({pageNumber:1,pageSize:5}),e=n(!1),t=async()=>{e.value=!0;const{data:c}=await se(r.value);b.value=c.records,_.value=c.total,e.value=!1};t();const s=n(),i=()=>{s.value.open({})},m=async c=>{console.log(c),await de.confirm("你确认删除该审批吗？","温馨提示",{type:"warning",confirmButtonText:"确认",cancelButtonText:"取消"}),await ue(c.id),F({type:"success",message:"删除成功"}),t()},u=c=>{console.log(c),t()},k=c=>{r.value.pageNumber=1,r.value.pageSize=c,t()},S=()=>{t()};return(c,C)=>{const v=T,V=X,z=Y,x=ee,h=ae,E=W,U=te;return w(),A("div",null,[a(E,{title:"审批流程管理"},{extra:o(()=>[a(v,{type:"primary",onClick:i},{default:o(()=>[L("创建审批实例")]),_:1})]),default:o(()=>[q((w(),R(x,{data:b.value,style:{width:"100%"}},{empty:o(()=>[a(z,{description:"没有数据"})]),default:o(()=>[a(V,{prop:"createName",label:"创建人姓名"}),a(V,{prop:"nodeCounts",label:"节点数量"}),a(V,{prop:"processName",label:"流程名称",width:"160"}),a(V,{label:"操作",width:"200"},{default:o(g=>[a(v,{icon:J(oe),circle:"",plain:"",type:"danger",onClick:d=>m(g.row)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[U,e.value]]),a(h,{"current-page":r.value.pageNumber,"onUpdate:currentPage":C[0]||(C[0]=g=>r.value.pageNumber=g),"page-size":r.value.pageSize,"onUpdate:pageSize":C[1]||(C[1]=g=>r.value.pageSize=g),"page-sizes":[2,3,4,5,10],layout:"jumper, total, sizes, prev, pager, next",background:"",total:_.value,onSizeChange:k,onCurrentChange:S,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),a(me,{ref_key:"dialog",ref:s,onSuccess:u},null,512)])}}};export{Le as default};
