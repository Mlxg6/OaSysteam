import{r,o as C,c as k,b as e,w as l,g as z,e as v,G as A,j as $}from"./index-CPZCLJhI.js";import{_ as B,E as U,b as M,a as j,c as F,v as O}from"./el-table-column-Cw6mIs8X.js";import{E as P}from"./el-input-EJwEnXI7.js";import"./el-popper-CBzjx_xb.js";import{E as L}from"./el-popover-C3aqIG8a.js";import{E as S}from"./el-button-aGybSvRj.js";import{g as G,a as H}from"./affairs-Nss4bU3P.js";import{E as Y}from"./el-dialog-DrTM45KF.js";import"./el-overlay-DNljXtA7.js";import{E as q,a as J}from"./el-form-item-CvQ51XjY.js";import{E as N}from"./request-Bo9Nm4OM.js";import"./_plugin-vue_export-helper-C52UWfAG.js";import"./_initCloneObject-CWwr7yUn.js";const K={class:"dialog-footer"},Q={__name:"ChanneReviewed",emits:["success"],setup(I,{expose:p,emit:d}){const a=r({content:"",affairId:0,viewAffairId:0,receiverName:"",receiverId:0}),i=r(!1),f=r();p({open:c=>{console.log(c),a.content="",a.value.affairId=c.id,a.value.viewAffairId=c.viewAffairId,a.value.receiverName=c.receiverName,a.value.receiverId=c.receiverId,i.value=!0}});const b=d,m=async()=>{if(a.value.content===""){N({message:"请输入通知意见"});return}console.log("参数",a.value),await G(a.value),b("success"),N({type:"success",message:"审阅成功"}),i.value=!1};return(c,u)=>{const w=P,h=q,y=J,o=S,n=Y;return C(),k("div",null,[e(n,{modelValue:i.value,"onUpdate:modelValue":u[2]||(u[2]=t=>i.value=t),title:"审阅通知",width:"50%"},{footer:l(()=>[z("div",K,[e(o,{onClick:u[1]||(u[1]=t=>i.value=!1)},{default:l(()=>[v("取消")]),_:1}),e(o,{type:"primary",onClick:m},{default:l(()=>[v("确认")]),_:1})])]),default:l(()=>[e(y,{model:a.value,"label-width":"100px",style:{"padding-right":"30px"},ref_key:"formRef",ref:f},{default:l(()=>[e(h,{label:"审阅意见"},{default:l(()=>[e(w,{modelValue:a.value.content,"onUpdate:modelValue":u[0]||(u[0]=t=>a.value.content=t),minlength:"1",maxlength:"20"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},W=["href"],me={__name:"handledAndRead",setup(I){const p=r([]),d=r(0),a=r({pageNumber:1,pageSize:5}),i=r(!1),f=r();(()=>{const o=new Date,n=o.getFullYear(),t=("0"+(o.getMonth()+1)).slice(-2),_=("0"+o.getDate()).slice(-2),g=("0"+o.getHours()).slice(-2),E=("0"+o.getMinutes()).slice(-2),x=("0"+o.getSeconds()).slice(-2);f.value=n+"-"+t+"-"+_+" "+g+":"+E+":"+x})();const b=r(),m=async()=>{i.value=!0;const o=await H(a.value);p.value=o.data.receiverAffairResponses,d.value=o.total,i.value=!1,console.log("获取待办通知列表",p.value);let n=!1;for(const t of p.value)if(t.cutOffTime<f.value&&!n){N({message:"请注意，您有代办通知超过截至时间"}),n=!0;break}};m();const c=r(),u=(o,n)=>{c.value.open(o)},w=()=>{m()},h=o=>{a.value.pageNumber=1,a.value.pageSize=o,m()},y=o=>{m()};return(o,n)=>{const t=U,_=S,g=M,E=L,x=j,D=F,T=B,R=O;return C(),k("div",null,[e(T,{title:"待办通知"},{default:l(()=>[A((C(),$(g,{data:p.value,style:{width:"100%"}},{empty:l(()=>[e(x,{description:"没有数据"})]),default:l(()=>[e(t,{prop:"content",label:"文档内容"}),e(t,{prop:"createTime",label:"发起时间",width:"170"}),e(t,{prop:"cutOffTime",label:"截至时间",width:"170","class-name":b.value},null,8,["class-name"]),e(t,{label:"文件",width:"80"},{default:l(s=>[z("a",{href:s.row.fileUrl,download:"file"},"去下载",8,W)]),_:1}),e(t,{prop:"initiatorName",label:"发起人姓名"}),e(t,{prop:"receiverName",label:"审阅人"}),e(t,{prop:"title",label:"标题"}),e(t,{label:"审阅意见",width:"150"},{default:l(s=>[e(E,{placement:"right",width:400,trigger:"click"},{reference:l(()=>[e(_,{style:{"margin-right":"16px"}},{default:l(()=>[v("查看")]),_:1})]),default:l(()=>[e(g,{data:s.row.affairOpinions},{default:l(()=>[e(t,{width:"150",property:"receiverName",label:"通知人"}),e(t,{width:"300",property:"content",label:"通知备注"}),e(t,{width:"300",property:"createTime",label:"通知时间"})]),_:2},1032,["data"])]),_:2},1024)]),_:1}),e(t,{label:"操作",width:"150"},{default:l(s=>[e(_,{circle:"",plain:"",type:"primary",onClick:X=>u(s.row,s.$index)},{default:l(()=>[v("审阅")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[R,i.value]]),e(D,{"current-page":a.value.pageNumber,"onUpdate:currentPage":n[0]||(n[0]=s=>a.value.pageNumber=s),"page-size":a.value.pageSize,"onUpdate:pageSize":n[1]||(n[1]=s=>a.value.pageSize=s),"page-sizes":[2,3,4,5,10],layout:"jumper, total, sizes, prev, pager, next",background:"",total:d.value,onSizeChange:h,onCurrentChange:y,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),e(Q,{ref_key:"dialog",ref:c,onSuccess:w},null,512)])}}};export{me as default};
