import{u as N,r as d,o as c,c as b,b as a,w as o,g as U,e as v,d as g,_ as A,I as C,Z as F,j as S}from"./index-CPZCLJhI.js";import{E as M}from"./el-dialog-DrTM45KF.js";import"./el-overlay-DNljXtA7.js";import{E as j,a as Z}from"./el-form-item-CvQ51XjY.js";import{E as $}from"./el-input-EJwEnXI7.js";import{d as z,e as G}from"./el-table-column-Cw6mIs8X.js";import"./el-popper-CBzjx_xb.js";import{m as H,E as J}from"./file-5RXYfRAD.js";import{E as K}from"./el-button-aGybSvRj.js";import{f as P}from"./affairs-Nss4bU3P.js";import{d as Q}from"./user-IFSiVi_8.js";import{E}from"./request-Bo9Nm4OM.js";const W=U("div",{class:"el-upload__tip"},"支持office文档、图片格式，单文件上传大小限制10MB，最多上传1个附件 ",-1),X={class:"dialog-footer"},ce={__name:"ChannelEdit",emits:["success"],setup(Y,{expose:x,emit:y}){const _=N(),{fileList:f,fileUrl:w,onchange:D,handleRemove:h}=H(),p=d([]),n=d([]);(async()=>{const{data:s}=await Q();n.value=s,n.value=n.value.map(e=>({value:e.username,label:e.username,...e})),console.log("获取接收人",n.value)})();const l=d({importanceDegree:"",cutOffTime:"2024-05-27 14:38:41",id:"",content:"",fileUrl:"",title:"",receiverRequestList:[]}),q={importanceDegree:[{required:!0,message:"请输入重要程度",trigger:"blur"}],cutOffTime:[{required:!0,message:"请输入截至时间",trigger:"blur"}],id:[{required:!0,message:"请输入通知ID",trigger:"blur"}],title:[{required:!0,message:"请输入文档标题",trigger:"blur"}],content:[{required:!0,message:"请输入通知内容",trigger:"blur"}],fileUrl:[{required:!0,message:"请上传文件",trigger:"blur"}]},i=d(!1);x({open:s=>{i.value=!0}});const I=y,V=d(),L=async()=>{if(await V.value.validate(),p.value.length===0){E({message:"请选择接收人"});return}const s=l.value.id,e=p.value.map(u=>{const r=n.value.find(m=>m.id===u);return r?{receiverId:r.id,receiverName:r.username}:{}});l.value.receiverRequestList=e,l.value.initiatorId=_.user.id,l.value.initiatorName=_.user.username,l.value.id=parseInt(l.value.id),l.value.fileUrl=w.value,console.log("参数",l.value),await P(l.value),I("success"),E({type:"success",message:s?"编辑成功":"添加成功"}),i.value=!1};return(s,e)=>{const u=$,r=j,m=K,k=J,O=z,B=G,R=Z,T=M;return c(),b("div",null,[a(T,{modelValue:i.value,"onUpdate:modelValue":e[8]||(e[8]=t=>i.value=t),title:l.value.id?"编辑通知":"添加通知",width:"50%"},{footer:o(()=>[U("div",X,[a(m,{onClick:e[7]||(e[7]=t=>i.value=!1)},{default:o(()=>[v("取消")]),_:1}),a(m,{type:"primary",onClick:L},{default:o(()=>[v("确认")]),_:1})])]),default:o(()=>[a(R,{model:l.value,rules:q,"label-width":"100px",style:{"padding-right":"30px"},ref_key:"formRef",ref:V},{default:o(()=>[a(r,{label:"通知内容",prop:"content"},{default:o(()=>[a(u,{modelValue:l.value.content,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.content=t),minlength:"1",maxlength:"20"},null,8,["modelValue"])]),_:1}),a(r,{label:"通知标题",prop:"title"},{default:o(()=>[a(u,{modelValue:l.value.title,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.title=t),minlength:"1",maxlength:"20"},null,8,["modelValue"])]),_:1}),a(r,{label:"重要程度",prop:"importanceDegree"},{default:o(()=>[a(u,{modelValue:l.value.importanceDegree,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.importanceDegree=t),minlength:"1",maxlength:"20",placeholder:"输入数字：1高 2中 3低"},null,8,["modelValue"])]),_:1}),a(r,{label:"截止时间",prop:"cutOffTime"},{default:o(()=>[a(u,{modelValue:l.value.cutOffTime,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.cutOffTime=t),placeholder:"格式：2024-04-27 14:38:41"},null,8,["modelValue"])]),_:1}),a(r,{label:"通知ID",prop:"id"},{default:o(()=>[a(u,{modelValue:l.value.id,"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.id=t),minlength:"1",maxlength:"20"},null,8,["modelValue"])]),_:1}),a(r,{label:"上传文件"},{default:o(()=>[a(k,{"file-list":g(f),"onUpdate:fileList":e[5]||(e[5]=t=>A(f)?f.value=t:null),class:"upload-demo",limit:1,ref:"upload","auto-upload":!1,"on-change":g(D),"on-remove":g(h)},{tip:o(()=>[W]),default:o(()=>[a(m,{type:"success",icon:s.DocumentAdd},{default:o(()=>[v("添加附件")]),_:1},8,["icon"])]),_:1},8,["file-list","on-change","on-remove"])]),_:1}),a(r,{label:"选择接收人"},{default:o(()=>[a(B,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=t=>p.value=t),multiple:"",placeholder:"选择接收",style:{width:"240px"}},{default:o(()=>[(c(!0),b(C,null,F(n.value,t=>(c(),S(O,{key:t.id,label:t.value,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{ce as _};
