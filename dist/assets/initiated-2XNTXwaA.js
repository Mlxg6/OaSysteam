import{u as M,r as p,o as b,c as k,b as e,w as l,g as z,e as h,d as V,_ as R,I as q,Z as O,j as L,G as P}from"./index-CPZCLJhI.js";import{d as G,e as Z,_ as H,E as J,a as K,b as Q,c as W,v as X}from"./el-table-column-Cw6mIs8X.js";import{E as Y}from"./el-input-EJwEnXI7.js";import"./el-popper-CBzjx_xb.js";import{E as F}from"./el-button-aGybSvRj.js";import{v as ee}from"./_plugin-vue_export-helper-C52UWfAG.js";import{c as te,d as le,e as ae}from"./file-DOH4WcwV.js";import{E as oe}from"./el-dialog-DrTM45KF.js";import"./el-overlay-DNljXtA7.js";import{E as ne,a as se}from"./el-form-item-CvQ51XjY.js";import{m as ie,E as re}from"./file-5RXYfRAD.js";import{d as ue}from"./user-IFSiVi_8.js";import{E as N}from"./request-Bo9Nm4OM.js";import{E as pe}from"./el-message-box-JObjlNit.js";import"./_initCloneObject-CWwr7yUn.js";const ce=z("div",{class:"el-upload__tip"},"支持office文档、图片格式，单文件上传大小限制10MB，最多上传1个附件 ",-1),de={class:"dialog-footer"},me={__name:"ChannelEdit",emits:["success"],setup(I,{expose:y,emit:E}){const i=M(),{fileList:m,fileUrl:_,onchange:w,handleRemove:C}=ie(),f=p([]),d=p([]);(async()=>{const{data:c}=await ue();d.value=c,d.value=d.value.map(t=>({value:t.username,label:t.username,...t})),console.log("获取接收人",d.value)})();const o=p({initiatorId:i.user.id,content:"",fileUrl:"",initiatorName:i.user.username,title:"",receivers:[]}),s={title:[{required:!0,message:"请输入文档标题",trigger:"blur"}],content:[{required:!0,message:"请输入文档内容",trigger:"blur"}]},r=p(!1);y({open:c=>{r.value=!0,o.value={...c}}});const u=E,x=p(),S=async()=>{if(await x.value.validate(),f.value.length===0){N({message:"请选择接收人"});return}const c=o.value.id,t=f.value.map(g=>{const a=d.value.find(v=>v.id===g);return a?{receiverId:a.id,receiverName:a.username}:{}});o.value.receivers=t,o.value.initiatorId=i.user.id,o.value.initiatorName=i.user.username,o.value.fileUrl=_.value,console.log("参数",o.value),await te(o.value),u("success"),N({type:"success",message:c?"编辑成功":"添加成功"}),r.value=!1};return(c,t)=>{const g=Y,a=ne,v=F,T=re,D=G,$=Z,j=se,A=oe;return b(),k("div",null,[e(A,{modelValue:r.value,"onUpdate:modelValue":t[5]||(t[5]=n=>r.value=n),title:o.value.id?"编辑阅文":"添加阅文",width:"50%"},{footer:l(()=>[z("div",de,[e(v,{onClick:t[4]||(t[4]=n=>r.value=!1)},{default:l(()=>[h("取消")]),_:1}),e(v,{type:"primary",onClick:S},{default:l(()=>[h("确认")]),_:1})])]),default:l(()=>[e(j,{model:o.value,rules:s,"label-width":"100px",style:{"padding-right":"30px"},ref_key:"formRef",ref:x},{default:l(()=>[e(a,{label:"文档内容",prop:"content"},{default:l(()=>[e(g,{modelValue:o.value.content,"onUpdate:modelValue":t[0]||(t[0]=n=>o.value.content=n),minlength:"1",maxlength:"20"},null,8,["modelValue"])]),_:1}),e(a,{label:"文档标题",prop:"title"},{default:l(()=>[e(g,{modelValue:o.value.title,"onUpdate:modelValue":t[1]||(t[1]=n=>o.value.title=n),minlength:"1",maxlength:"20"},null,8,["modelValue"])]),_:1}),e(a,{label:"上传文件"},{default:l(()=>[e(T,{"file-list":V(m),"onUpdate:fileList":t[2]||(t[2]=n=>R(m)?m.value=n:null),class:"upload-demo",limit:1,ref:"upload","auto-upload":!1,"on-change":V(w),"on-remove":V(C)},{tip:l(()=>[ce]),default:l(()=>[e(v,{type:"success",icon:c.DocumentAdd},{default:l(()=>[h("添加附件")]),_:1},8,["icon"])]),_:1},8,["file-list","on-change","on-remove"])]),_:1}),e(a,{label:"选择接收人"},{default:l(()=>[e($,{modelValue:f.value,"onUpdate:modelValue":t[3]||(t[3]=n=>f.value=n),multiple:"",placeholder:"选择接收",style:{width:"240px"}},{default:l(()=>[(b(!0),k(q,null,O(d.value,n=>(b(),L(D,{key:n.id,label:n.value,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},_e=["href"],ze={__name:"initiated",setup(I){const y=p([]),E=p(0),i=p({pageNumber:1,pageSize:5}),m=p(!1),_=async()=>{m.value=!0;const{data:s}=await le(i.value);console.log("获取列表",s),y.value=s.list,E.value=s.total,m.value=!1};_();const w=p(),C=()=>{w.value.open({})},f=async(s,r)=>{console.log(s,r),await pe.confirm("你确认删除该发起吗？","温馨提示",{type:"warning",confirmButtonText:"确认",cancelButtonText:"取消"}),await ae(s.documentId),N({type:"success",message:"删除成功"}),_()},d=s=>{console.log(s),_()},B=s=>{i.value.pageNumber=1,i.value.pageSize=s,_()},o=()=>{_()};return(s,r)=>{const U=F,u=J,x=K,S=Q,c=W,t=H,g=X;return b(),k("div",null,[e(t,{title:"发起传阅"},{extra:l(()=>[e(U,{type:"primary",onClick:C},{default:l(()=>[h(" 发起阅文 ")]),_:1})]),default:l(()=>[P((b(),L(S,{data:y.value,style:{width:"100%"}},{empty:l(()=>[e(x,{description:"没有数据"})]),default:l(()=>[e(u,{prop:"content",label:"文档内容"}),e(u,{prop:"createTime",label:"创建时间"}),e(u,{label:"文件",width:"80"},{default:l(a=>[z("a",{href:a.row.fileUrl,download:"file"},"去下载",8,_e)]),_:1}),e(u,{prop:"initiatorName",label:"发起人姓名"}),e(u,{prop:"title",label:"文档标题"}),e(u,{prop:"receiverName",label:"接收人姓名"}),e(u,{prop:"opinion",label:"意见"}),e(u,{prop:"auditTime",label:"审阅时间"}),e(u,{label:"操作",width:"150"},{default:l(a=>[e(U,{icon:V(ee),circle:"",plain:"",type:"danger",onClick:v=>f(a.row,a.$index)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[g,m.value]]),e(c,{"current-page":i.value.pageNumber,"onUpdate:currentPage":r[0]||(r[0]=a=>i.value.pageNumber=a),"page-size":i.value.pageSize,"onUpdate:pageSize":r[1]||(r[1]=a=>i.value.pageSize=a),"page-sizes":[2,3,4,5,10],layout:"jumper, total, sizes, prev, pager, next",background:"",total:E.value,onSizeChange:B,onCurrentChange:o,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),e(me,{ref_key:"dialog",ref:w,onSuccess:d},null,512)])}}};export{ze as default};
