import{r as n,o as g,c as N,b as t,w as l,g as $,e as h,j as x,V as R,I as B,Z as D,G as F}from"./index-CPZCLJhI.js";import{d as T,e as j,_ as M,E as O,a as q,b as A,c as P,v as G}from"./el-table-column-Cw6mIs8X.js";import{E as Z}from"./el-input-EJwEnXI7.js";import"./el-popper-CBzjx_xb.js";import{E as L}from"./el-button-aGybSvRj.js";import{g as H,a as J,b as K}from"./file-DOH4WcwV.js";import{E as Q}from"./el-dialog-DrTM45KF.js";import"./el-overlay-DNljXtA7.js";import{E as W,a as X}from"./el-form-item-CvQ51XjY.js";import{d as Y}from"./user-IFSiVi_8.js";import{E as I}from"./request-Bo9Nm4OM.js";import"./_plugin-vue_export-helper-C52UWfAG.js";import"./_initCloneObject-CWwr7yUn.js";const ee={class:"dialog-footer"},te={__name:"ChanneReviewed",emits:["success"],setup(U,{expose:y,emit:w}){const u=n([]),i=n([]);(async()=>{const{data:a}=await Y();i.value=a,i.value=i.value.map(e=>({value:e.username,label:e.username,...e})),console.log("获取接收人",i.value)})();const r=n({opinion:"",documentId:0}),m=n({documentId:0,receiverRequestList:[]}),v=n(!1),p=n("");y({open:(a,e)=>{r.opinion="",m.value.documentId=a.documentId,r.value.documentId=a.documentId,v.value=!0,e&&(p.value=e)}});const k=w,o=n(),d=async()=>{const a=u.value.map(e=>{const _=i.value.find(b=>b.id===e);return _?{receiverId:_.id,receiverName:_.username}:{}});if(m.value.receiverRequestList=a,p.value==="审阅"){if(r.value.opinion===""){I({message:"请输入审阅意见"});return}console.log("参数",r.value),await H(r.value)}else{if(u.value.length===0){I({message:"请选择接收人"});return}console.log("参数",m.value),await J(m.value)}k("success"),I({type:"success",message:p.value==="审阅"?"审阅成功":"转发成功"}),v.value=!1};return(a,e)=>{const _=Z,b=W,E=X,C=T,V=j,s=L,z=Q;return g(),N("div",null,[t(z,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=c=>v.value=c),title:p.value==="审阅"?"审阅阅文":"转发阅文",width:"50%"},{footer:l(()=>[$("div",ee,[t(s,{onClick:e[2]||(e[2]=c=>v.value=!1)},{default:l(()=>[h("取消")]),_:1}),t(s,{type:"primary",onClick:d},{default:l(()=>[h("确认")]),_:1})])]),default:l(()=>[p.value==="审阅"?(g(),x(E,{key:0,model:r.value,"label-width":"100px",style:{"padding-right":"30px"},ref_key:"formRef",ref:o},{default:l(()=>[t(b,{label:"审阅意见"},{default:l(()=>[t(_,{modelValue:r.value.opinion,"onUpdate:modelValue":e[0]||(e[0]=c=>r.value.opinion=c),minlength:"1",maxlength:"20"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):R("",!0),p.value==="转发"?(g(),x(E,{key:1,model:m.value,"label-width":"100px",style:{"padding-right":"30px"},ref_key:"formRef",ref:o},{default:l(()=>[t(b,{label:"选择接收人"},{default:l(()=>[t(V,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=c=>u.value=c),multiple:"",placeholder:"选择接收",style:{width:"240px"}},{default:l(()=>[(g(!0),N(B,null,D(i.value,c=>(g(),x(C,{key:c.id,label:c.value,value:c.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])):R("",!0)]),_:1},8,["modelValue","title"])])}}},ae=["href"],ge={__name:"handledAndRead",setup(U){const y=n([]),w=n(0),u=n({pageNumber:1,pageSize:5}),i=n(!1),f=async()=>{i.value=!0;const{data:o}=await K(u.value);console.log("获取列表",o),y.value=o.list,w.value=o.total,i.value=!1};f();const r=n(),m=(o,d)=>{const a=n("审阅");r.value.open(o,a.value)},v=async(o,d)=>{const a=n("转发");r.value.open(o,a.value),f()},p=()=>{f()},S=o=>{u.value.pageNumber=1,u.value.pageSize=o,f()},k=o=>{f()};return(o,d)=>{const a=O,e=L,_=q,b=A,E=P,C=M,V=G;return g(),N("div",null,[t(C,{title:"待阅列表"},{default:l(()=>[F((g(),x(b,{data:y.value,style:{width:"100%"}},{empty:l(()=>[t(_,{description:"没有数据"})]),default:l(()=>[t(a,{prop:"content",label:"文档内容"}),t(a,{prop:"createTime",label:"创建时间"}),t(a,{label:"文件",width:"80"},{default:l(s=>[$("a",{href:s.row.fileUrl,download:"file"},"去下载",8,ae)]),_:1}),t(a,{prop:"initiatorName",label:"发起人姓名"}),t(a,{prop:"receiverName",label:"接收人姓名"}),t(a,{prop:"title",label:"标题"}),t(a,{label:"操作",width:"150"},{default:l(s=>[t(e,{circle:"",plain:"",type:"primary",onClick:z=>m(s.row,s.$index)},{default:l(()=>[h("审阅")]),_:2},1032,["onClick"]),t(e,{circle:"",plain:"",type:"danger",onClick:z=>v(s.row,s.$index)},{default:l(()=>[h("转发")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[V,i.value]]),t(E,{"current-page":u.value.pageNumber,"onUpdate:currentPage":d[0]||(d[0]=s=>u.value.pageNumber=s),"page-size":u.value.pageSize,"onUpdate:pageSize":d[1]||(d[1]=s=>u.value.pageSize=s),"page-sizes":[2,3,4,5,10],layout:"jumper, total, sizes, prev, pager, next",background:"",total:w.value,onSizeChange:S,onCurrentChange:k,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),t(te,{ref_key:"dialog",ref:r,onSuccess:p},null,512)])}}};export{ge as default};
